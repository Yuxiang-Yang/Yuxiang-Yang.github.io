import{d as T,N as P,a8 as N,ac as X,a0 as J,w as x,a4 as W,a5 as Z,f as d,a as h,e as R,m as _,t as ee,a1 as r,n as I,c as v,o as M,a7 as k,r as te,z as ne,Q as oe,h as S,j as V,b as p,$ as m,u as le,g as B,l as ae,Y as ie,ad as se}from"./framework.C67NHIEM.js";import{i as ue,b as re,a as E,_ as D}from"./Icon.vue_vue_type_script_setup_true_lang.BRtaCtH0.js";import{_ as de}from"./Input.vue_vue_type_script_setup_true_lang.CsDI1lLb.js";import{d as ce,_ as fe}from"./Tooltip.vue_vue_type_script_setup_true_lang.DAjjqTIj.js";var ve="[object Number]";function pe(o){return typeof o=="number"||ue(o)&&re(o)==ve}function me(o=""){return o.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}const z=Symbol("selectContextKey"),he=["id"],xe=T({name:"ChOption",__name:"Option",props:{label:{},value:{},disabled:{type:Boolean,default:!1}},setup(o,{expose:b}){var c;const l=P(z),e=N({visible:!0,hover:!1,selected:!1,disabled:o.disabled});b({label:o.label,value:o.value,updateOption:y,states:e});const i=(c=X())==null?void 0:c.exposed;l.onOptionCreate(i),J(()=>{l.onOptionDestroy(o.value,i)}),x(()=>o.value,(a,u)=>{a!==u&&(l.onOptionDestroy(o.value,i),l.onOptionCreate(i))});function g(){o.disabled||(l.states.hoveringIndex=l==null?void 0:l.optionsArray.value.indexOf(i))}function O(){o.disabled||l==null||l.handleSelect(i)}function y(a){const f=new RegExp(me(a),"i").test(String(o.label));e.visible=f}return(a,u)=>W((d(),h("li",{id:`select-item-${a.value}`,class:I(["ch-select-dropdown__item",{"is-disabled":a.disabled,"is-selected":e.selected,"is-hovering":e.hover}]),onClick:r(O,["stop"]),onMousedown:r(()=>{},["prevent"]),onMousemove:g},[R(a.$slots,"default",{},()=>[_(ee(a.label),1)])],42,he)),[[Z,e.visible]])}}),be={key:0,class:"ch-select__loading"},ge={key:1,class:"ch-select__nodata"},Oe={class:"ch-select-dropdown__list"},Ie=T({name:"ChSelect",__name:"Select",props:{modelValue:{},placeholder:{},disabled:{type:Boolean},effect:{default:"light"},clearable:{type:Boolean},filterable:{type:Boolean,default:!1},filterMethod:{type:Function},remote:{type:Boolean},remoteMethod:{type:Function},loading:{type:Boolean}},emits:["change","update:modelValue","visibleChange","clear"],setup(o,{emit:b}){const l=b,e=N({inputValue:"",options:new Map,selectedOption:null,mouseHover:!1,hoveringIndex:-1,hoveringOption:null}),i=v(()=>Array.from(e.options.values())),g=v(()=>{let t=0;for(const n of e.options.values())n.states.visible&&t++;return t});M(()=>{const t=O(o.modelValue);e.inputValue=t?t.label:"",e.selectedOption=t});function O(t){let n=null;for(const s of e.options.values())s.value===t&&(n=s);return n}const y=k("input"),c=k("tooltip"),a=te(!1);function u(t){var n,s;if(t){o.filterable&&e.selectedOption&&(e.inputValue=""),o.remote||C(),f();debugger;(n=c.value)==null||n.show()}else(s=c.value)==null||s.hide(),o.filterable&&e.selectedOption&&(e.inputValue=e.selectedOption.label);a.value=t,l("visibleChange",t)}function f(){e.hoveringIndex=e.selectedOption?i.value.indexOf(e.selectedOption):-1}M(()=>{f()});function H(){o.disabled||(a.value?u(!1):u(!0))}function K(){if(!a.value){u(!0);return}e.hoveringIndex>-1&&i.value[e.hoveringIndex]&&$(i.value[e.hoveringIndex])}function j(){a.value&&u(!1)}function w(t){if(!a.value){u(!0);return}if(e.options.size===0)return;t==="next"?(e.hoveringIndex++,e.hoveringIndex===e.options.size&&(e.hoveringIndex=0)):t==="prev"&&(e.hoveringIndex--,e.hoveringIndex<0&&(e.hoveringIndex=e.options.size-1));const n=i.value[e.hoveringIndex];(n.states.disabled||!n.states.visible)&&w(t)}x(()=>e.hoveringIndex,t=>{pe(t)&&t>-1?e.hoveringOption=i.value[t]||{}:e.hoveringOption=null,i.value.forEach(n=>{n.states.hover=e.hoveringOption===n})}),x(()=>e.selectedOption,()=>{i.value.forEach(t=>{t.states.selected=e.selectedOption===t})});const A=v(()=>o.filterable&&e.selectedOption&&a.value?String(e.selectedOption.label):o.placeholder),F=v(()=>o.clearable&&e.mouseHover&&e.selectedOption&&e.inputValue);function Q(){e.inputValue="",e.selectedOption=null,l("clear"),l("update:modelValue",""),l("change","")}function C(){if(o.filterable)for(const t of e.options.values()){const n=String(e.inputValue);t.updateOption(n)}}ne(()=>{o.remote||C()});function L(){if(f(),o.filterable&&E(o.filterMethod)){o.filterMethod(e.inputValue);return}else if(o.remote&&E(o.remoteMethod)){o.remoteMethod(e.inputValue);return}oe(()=>C())}const U=v(()=>o.remote?300:0),Y=ce(L,U.value);function $(t){var n,s;t.states.disabled||(e.selectedOption=t,e.inputValue=t.label,l("update:modelValue",t.value),l("change",t.value),u(!1),(s=(n=y.value)==null?void 0:n.ref)==null||s.focus())}function q(t){e.options.set(t.value,t)}function G(t,n){se(e.options.get(t))===n&&e.options.delete(t)}return ie(z,{states:e,handleSelect:$,onOptionCreate:q,onOptionDestroy:G,optionsArray:i}),(t,n)=>(d(),h("div",{class:I(["ch-select",{"is-disabled":t.disabled}]),onClick:H},[S(fe,{ref:"tooltip",placement:"bottom",manual:"",effect:t.effect,"hide-after":0,"same-width":"",onClickOutside:n[5]||(n[5]=s=>u(!1))},{content:V(()=>[t.loading?(d(),h("div",be,n[6]||(n[6]=[p("span",null,"loading",-1)]))):t.filterable&&g.value===0?(d(),h("div",ge,n[7]||(n[7]=[p("span",null,"no matching data",-1)]))):ae("",!0),p("ul",Oe,[R(t.$slots,"default")])]),default:V(()=>[p("div",{class:"ch-select_wrapper",onMouseenter:n[3]||(n[3]=s=>e.mouseHover=!0),onMouseleave:n[4]||(n[4]=s=>e.mouseHover=!1)},[S(de,{ref:"input",modelValue:e.inputValue,"onUpdate:modelValue":n[0]||(n[0]=s=>e.inputValue=s),readonly:!t.filterable||!a.value,disabled:t.disabled,placeholder:A.value,onInput:le(Y),onKeydown:[m(r(K,["stop","prevent"]),["enter"]),m(r(j,["stop","prevent"]),["esc"]),n[1]||(n[1]=m(r(s=>w("next"),["stop","prevent"]),["down"])),n[2]||(n[2]=m(r(s=>w("prev"),["stop","prevent"]),["up"]))]},{suffix:V(()=>[F.value?(d(),B(D,{key:0,icon:"circle-xmark",class:"ch-input__clear",onMousedown:r(()=>{},["prevent"]),onClick:r(Q,["stop"])})):(d(),B(D,{key:1,icon:"angle-down",class:I(["ch-select__caret",{"is-active":a.value}]),onMousedown:r(()=>{},["prevent"])},null,8,["class"]))]),_:1},8,["modelValue","readonly","disabled","placeholder","onInput","onKeydown"])],32)]),_:3},8,["effect"])],2))}});export{Ie as _,xe as a};
